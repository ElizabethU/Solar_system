$(document).ready(function(){

    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

    var renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    var center = new THREE.Vector3( 0, 0, 0 );

    camera.position.z = 15;
    camera.position.y = 6;
    camera.lookAt( center )

    // ThreeX click event library
    var domEvents   = new THREEx.DomEvents(camera, renderer.domElement)
    planets.forEach( function( planet ){

      window[planet.name] = new THREE.Mesh( 
        new THREE.SphereGeometry(planet.diameter,15,15),
        new THREE.MeshBasicMaterial( { 
          color: parseInt('0x' + planet.color)
        }));
      scene.add( window[planet.name] );
      eval(planet.name).position.x = planet.x * 10
      eval(planet.name).position.y = planet.y * 10
      eval(planet.name).position.z = planet.z * 10

      domEvents.addEventListener(eval(planet.name), 'click', function(event){
        console.log( planet.name );
        $( "#" + planet.name + "_info" ).modal();
      }, false);

    });

    function render() {
        requestAnimationFrame(render);
        sol.rotation.x += 0.1;
        sol.rotation.y += 0.03;
        renderer.render(scene, camera);
      }

    render();

var speed = .2

  $( document ).keydown(function(e) {
    if (e.keyCode < 37 || e.keyCode > 40) return true
    var radius = Math.sqrt(Math.pow(camera.position.x, 2) + Math.pow(camera.position.y, 2) + Math.pow(camera.position.z, 2))
    var angleUp = Math.asin(camera.position.y / radius)
    var angleSide = Math.atan(camera.position.x / camera.position.z)
    if (e.keyCode === 38) {
      //alert( "Up!" );
      camera.position.y = radius * Math.sin(angleUp + speed)
      b = radius * Math.cos(Math.asin( camera.position.y / radius))
      camera.position.x = b * Math.sin( Math.atan(camera.position.x / camera.position.z ))
      camera.position.z = b * Math.cos( Math.atan(camera.position.x / camera.position.z ))
      camera.lookAt( center )
      console.log(camera.position)
    } else if (e.keyCode === 40) {
      //alert( "Down!" );
      camera.position.y = radius * Math.sin(angleUp - speed)
      b = radius * Math.cos(Math.asin( camera.position.y / radius))
      camera.position.x = b * Math.sin( Math.atan(camera.position.x / camera.position.z ))
      camera.position.z = b * Math.cos( Math.atan(camera.position.x / camera.position.z ))
      camera.lookAt( center )
      console.log(camera.position)
    } else if (e.keyCode === 37) {
      //alert( "Left!" );
      camera.position.x = camera.position.z * Math.tan(angleSide - speed)
      b = radius * Math.cos(Math.asin( camera.position.y / radius))
      camera.position.z = Math.sqrt(Math.pow(b, 2) - Math.pow(camera.position.x, 2))
      camera.lookAt( center )
      console.log(camera.position)
    } else if (e.keyCode === 39) {
      //alert( "Right!" );
      camera.position.x = camera.position.z * Math.tan(angleSide + speed)
      b = radius * Math.cos(Math.asin( camera.position.y / radius))
      camera.position.z = Math.sqrt(Math.pow(b, 2) - Math.pow(camera.position.x, 2))
      camera.lookAt( center )
      console.log(camera.position)
    }; 
    return false
  });
});